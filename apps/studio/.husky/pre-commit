#!/bin/sh

# Sync fallback manifest if out of sync
if ! cmp -s projects/gridfinity/project.json apps/studio/src/config/fallback-manifest.json; then
  echo "husky: Syncing fallback manifest before commit..."
  cp projects/gridfinity/project.json apps/studio/src/config/fallback-manifest.json
  git add apps/studio/src/config/fallback-manifest.json
fi

# Run Lint Staged in Studio
(cd apps/studio && npx lint-staged) || exit 1

# Run Python Linting (Ruff)
STAGED_PY=$(git diff --cached --name-only --diff-filter=ACM -- '*.py')
if [ -n "$STAGED_PY" ]; then
  if command -v ruff >/dev/null 2>&1; then
    echo "$STAGED_PY" | xargs ruff check
  else
    echo "Warning: ruff not found, skipping Python lint"
  fi
fi
