# Verification Suite Documentation

The project maintains a rigorous quality assurance process using the custom Python script `tests/verify_design.py`.

## Overview

The verification script uses the `trimesh` library to analyze the exported STL geometry. It performs two types of checks: **Single Part Integrity** and **Assembly Fit**.

## Script: `tests/verify_design.py`

### Usage
```bash
# Verify the default model
python3 tests/verify_design.py

# Verify a specific file (e.g. generated by Web App)
python3 tests/verify_design.py path/to/preview.stl
```

### Exit Codes

| Code | Meaning |
|------|---------|
| `0` | All checks passed |
| `1` | One or more checks failed |

### Tests Performed

#### 1. Single Part Verification
-   **Watertightness**: Checks if the mesh is a closed manifold (no holes).
    -   *Current Status*: May report "Not Watertight" due to minor artifacts from snap relief slot cuts, but functional.
-   **Volume Count**: Verifies the object is a single continuous solid.
    -   *Goal*: `Volumes: 1`.
    -   *Mitigation*: Weld cubes integrated into `mechanism_pillars()` ensure connectivity.
-   **Dimensions**: Measures the bounding box.
    -   *Requirement*: XY ~`[20, 20]` mm; Z between 8–14 mm (varies with snap beam protrusion).
-   **Facet Count (Feature Presence)**: Verifies geometric complexity exceeds a minimum threshold.
    -   *Purpose*: Catches regressions where snap-fit features silently disappear from the render.
    -   *Threshold*: ≥400 facets (a plain half-cube without snaps has ~200).

#### 2. Assembly Verification
-   **Simulation**: Duplicate the mesh, rotate it 180° around X and 90° around Z.
-   **Collision Check**: Uses `trimesh.collision.CollisionManager` (interfaces with FCL).
    -   *Pass*: No collision (Distance > 0).
    -   *Current Behavior*: May report collision (Distance 0.0) because parts are designed with a tight sliding fit. The `fit_clear` parameter (0.2mm) creates the physical gap, but the mathematical intersection can be touching.

## Web Interface Integration

The verification suite is invoked from the [Web Interface](./web_interface.md) via the "Run Verification Suite" button. The backend endpoint `POST /api/verify` accepts a `mode` field (e.g., `"unit"`, `"assembly"`, `"grid"`) and resolves the corresponding part list from the [project manifest](./manifest.md).

For example, verifying in Grid mode checks all four parts: `bottom`, `top`, `rods`, and `stoppers`.

[Back to Index](./index.md)
